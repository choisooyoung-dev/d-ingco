<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap css cdn -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./style.css" />
    <title>D-ingco</title>
  </head>
  <body>
    <h1>Main page</h1>
    <nav>
      <div class="navbar_wrap">
        <div class="logo"></div>
        <ul class="menu">
          <li class="login_btn show">
            <a href="/test-views/users/login.html">로그인</a>
          </li>
          <li class="login_btn show">
            <a href="/test-views/users/signup.html">회원가입</a>
          </li>
          <li class="my_posts"><a href="/products/:usersid">내 글</a></li>
          <li class="logout_btn">
            <button onclick="submitLogout()">로그아웃</button>
          </li>
        </ul>
      </div>
    </nav>

    <section>
      <div id="post_list" class="row row-cols-1 row-cols-md-4 g-4">
        <!-- 
        <div id=post_"${e.post_id}" class="col">
          <strong>
            <a href="http://localhost:5500/test-views/posts/detail.html?post_id=${e.post_id}">div에 href 씌워야함</a>
          </strong>
          <div class="card">
            <img src="..." class="card-img-top" alt="..." />
            <div class="card-body">
              <h5 class="card-title">게시글 제목</h5>
              <p class="card-text">게시글 내용</p>
            </div>
            <div class="card-body">작성자 이름</div>                  
          </div>
        </div> 
        -->
      </div>
    </section>

    <!-- Bootstrap js cdn -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>

    <!-- 게시글 조회 axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // 브라우저가 열렸을 때 실행
      document.addEventListener('DOMContentLoaded', function () {
        console.log('document.cookie: ', document.cookie);
        const $post_list = document.getElementById('post_list');

        axios
          .get('http://localhost:3000/api/posts')
          .then((response) => {
            // API 실행결과를 response로 받아와서 html 그려주기
            console.log('response.data: ', response.data);
            response.data.forEach((e) => {
              let temp_html = `
                <div id=post_"${e.post_id}" class="col">
                  <strong>
                    <a href="http://localhost:5500/test-views/posts/detail.html?post_id=${e.post_id}">제발요${e.post_id}</a>
                  </strong>
                  <div class="card">
                    <img src="..." class="card-img-top" alt="..." />
                    <div class="card-body">
                      <h5 class="card-title">${e.title}</h5>
                      <p class="card-text">${e.content}</p>
                    </div>
                    <div class="card-body">${e.user.username}</div>                  
                  </div>
                </div> 
              `;
              $post_list.insertAdjacentHTML('beforeend', temp_html);
            });
          })
          .catch((error) => {
            console.error('오류 발생:', error);
          });
      });

      // 로그아웃을 눌렀을 때
      function submitLogout() {
        axios
          .get(`http://localhost:3000/api/users/logout`, {
            withCredentials: true,
          })
          .then((response) => {
            // 페이지 갱신하기
            alert('로그아웃되었습니다.');
            window.location.reload();
          })
          .catch((error) => {
            console.error('오류 발생:', error);
          });
      }
    </script>
  </body>
</html>
