<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Login</title>
  </head>

  <body>
    <div class="login-container">
      <h2>게시글 작성하기</h2>
      <form id="postEditForm">
        <div>
          제목 :
          <input type="text" id="title" placeholder="제목을 입력해주세요." />
        </div>
        <div>
          내용 :
          <input type="text" id="content" placeholder="내용을 입력해주세요." />
        </div>
        <button type="button" onclick="submitSaveForm()">저정하기</button>
        <button type="button" onclick="submitEditForm()">수정하기</button>
      </form>
    </div>

    <!-- 프론트 비동기처리(?)-->
    <!-- 프론트에서 백으로 데이터 넘겨주기!-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // 쿼리 스트링 post_id 받아오기
      const urlParams = new URLSearchParams(window.location.search);
      const post_id = urlParams.get('post_id');

      // DOM 요소들
      const $post_title = document.getElementById('title');
      const $post_content = document.getElementById('content');

      // 페이지가 열렸을 때 게시글 내용 조회
      document.addEventListener('DOMContentLoaded', function () {
        axios
          .get(`http://localhost:3000/api/posts/${post_id}`)
          .then((response) => {
            console.log('response: ', response);
            // API 실행결과를 response로 받아와서 html 그려주기
            response.data.post.forEach((e) => {
              $post_title.value = e.title;
              $post_content.value = e.content;
            });
          })
          .catch((error) => {
            console.error('오류 발생:', error);
          });
      });

      // 저장하기 버튼을 눌렀을 때 게시글 저장
      function submitSaveForm() {
        const $title_value = document.getElementById('title').value;
        const $content_value = document.getElementById('content').value;
        urlParams.append('title', $title_value);
        urlParams.append('content', $content_value);

        axios
          .post('http://localhost:3000/api/posts', urlParams, {
            withCredentials: true,
          })
          .then((response) => {
            // 게시글 조회 화면으로 이동시키기!
            alert('저장이 완료되었습니다.');
            window.location.href = `http://localhost:5500/test-views/posts/detail.html?post_id=${post_id}`;
          })
          .catch((error) => {
            console.error('오류 발생:', error);
          });
      }

      // 수정하기 버튼을 눌렀을 때 게시글 수정
      function submitEditForm() {
        // 쿼리 스트링 post_id 받아오기
        const urlParams = new URLSearchParams(window.location.search);
        const post_id = urlParams.get('post_id');
        const $post_title = document.getElementById('title').value;
        const $post_content = document.getElementById('content').value;

        // URLSearchParams() : URL 쿼리 문자열을 다루는 내장 클래스
        const params = new URLSearchParams();
        params.append('title', $post_title);
        params.append('content', $post_content);

        axios
          .put(`http://localhost:3000/api/posts/${post_id}`, params, {
            withCredentials: true,
          })
          .then((response) => {
            // 게시글 조회 화면으로 이동시키기!
            alert('수정이 완료되었습니다.');
            window.location.href = `http://localhost:5500/test-views/posts/detail.html?post_id=${post_id}`;
          })
          .catch((error) => {
            console.error('오류 발생:', error);
          });
      }
    </script>
  </body>
</html>
